<dom-module id="main-view">
  <style>

    :host {
      display: block;
    }

  </style>
  <template>

    <template is="dom-repeat" items="{{_items}}" on-dom-change="domchange">
      <h3 hidden="{{!_showDate(item)}}"><hr>Date: <i>{{_formatDate(item.date)}}</i></h3>
      <h2>{{item.name}}</h2>    
    </template>

  </template>
  <script>

    var aDay = 24 * 60 * 60 * 1000;
    
    Polymer({

      is: 'main-view',
      
      behaviors: [
        Polymer.CarbonMore
      ],
      
      properties: {
        items: {
          value: function() {
            var date = Date.now() - aDay * 1000;
            var result = [];
            for (var i=0; i<5000; i++) {
              result.push({name: i, index: i, date: date});
              date += aDay / 24;
            }
            return result;
          }
        }
      },
      
      ready: function() {
        document.body.scrollTop = 0;
        this._items = this.items.slice(0, 50);
      },
      
      _showDate: function(item) {
        var i0 = this.items[item.index-1];
        return !i0 || (new Date(i0.date).getDate() != new Date(item.date).getDate());
      },
      
      _formatDate: function(date) {
        return new Date(date).toLocaleDateString();
      },
      
      _more: function(delta) {
        var l = this._items.length;
        var d = this.items.length - l;
        if (d > 0) {
          var c = 50;
          //var c = Math.min(d, 50 * (Math.floor(delta/500) + 1));
          for (var i=0; i<c; i++) {
            this.push('_items', this.items[l+i]);
          }
          //this._items = this.items.slice(0, this._items.length + 50);
          console.log(c, this._items.length);
        }
      },
      
      domchange: function() {
        //console.log('dom-change');
      }

    });

  </script>
</dom-module>